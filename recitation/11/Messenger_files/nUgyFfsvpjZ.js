if (self.CavalryLogger) { CavalryLogger.start_js(["iGLSH"]); }

__d('MessengerAttachmentImageBlockUtils',['isFacebookURI','URI'],(function a(b,c,d,e,f,g){'use strict';function h(k){return k.getPath().indexOf('/moments_app')===0;}function i(k,l){return k<=300&&l<=300;}function j(k,l,m){if(i(k,l))return true;return c('isFacebookURI')(m)&&!m.isLinkshimURI()&&!h(m);}f.exports={isIcon:j};}),null);
__d('MessengerAttachmentImageBlock.react',['cx','React','URI','joinClasses','MessengerAttachmentImageBlockUtils'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;function l(){var m,n;for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];return n=(m=j.constructor).call.apply(m,[this].concat(p)),this.$MessengerAttachmentImageBlock3=function(){var r=this.props.attachment.properties||this.props.attachment.media.image_size||{},s=r.height,t=r.width;if(s&&t){s=parseInt(s,10);t=parseInt(t,10);return {height:s,width:t};}return {height:0,width:0};}.bind(this),n;}l.prototype.render=function(){return c('React').createElement('div',{className:c('joinClasses')(this.props.className,this.$MessengerAttachmentImageBlock1())},this.$MessengerAttachmentImageBlock2(),c('React').createElement('div',{className:"_5swm"},this.props.children));};l.prototype.$MessengerAttachmentImageBlock2=function(){if(!this.props.attachment.media||!this.props.attachment.media.image)return null;var m=this.$MessengerAttachmentImageBlock3(),n=m.height,o=m.width,p=n>o,q=new (c('URI'))(this.props.attachment.uri),r=c('MessengerAttachmentImageBlockUtils').isIcon(n,o,q),s=n&&o?n/o*100:100,t=p||r?.2:1,u=p||r?s:52,v={backgroundImage:'url('+this.props.attachment.media.image+')',minHeight:'0px',paddingBottom:p&&s>150?'136px':u*t+'%'};if(this.props.attachment.description&&this.props.attachment.source)v.minHeight='112px';return c('React').createElement('div',{className:"_3xn1",style:v});};l.prototype.$MessengerAttachmentImageBlock1=function(){if(!this.props.attachment.media||!this.props.attachment.media.image)return "_3xn3 _5swn";var m=this.$MessengerAttachmentImageBlock3(),n=m.height,o=m.width,p=n>o,q=new (c('URI'))(this.props.attachment.uri),r=c('MessengerAttachmentImageBlockUtils').isIcon(n,o,q);return "_3xn3"+(r&&!p?' '+"_3xn5":'')+(p?' '+"_3xn6":'')+(o>=n&&!r?' '+"_3xn7":'');};l.propTypes={attachment:k.object.isRequired};f.exports=l;}),null);
__d('MercuryShareImage.react',['cx','ChatImageArrowDirection','ChatImageWithArrow.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;l.prototype.render=function(){return c('React').createElement('div',{className:"_4hsl"},c('React').createElement(c('ChatImageWithArrow.react'),{arrowDirection:c('ChatImageArrowDirection').BOTH,height:this.props.height,round:!!this.props.round,source:this.props.source,width:this.props.width}));};function l(){i.apply(this,arguments);}l.propTypes={height:k.number.isRequired,round:k.bool,source:k.string.isRequired,width:k.number.isRequired};f.exports=l;}),null);
__d('MercuryFallbackShareAttachmentTextBlock.react',['cx','LineClamp.react','MercuryShareAttachmentRenderLocations','MercuryShareAttachmentReactShape','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;l.prototype.render=function(){if(!this.props||!this.props.attachment)return c('React').createElement('div',{className:"__6j"});if(c('MercuryShareAttachmentRenderLocations').MESSENGER===this.props.location)return c('React').createElement('div',{className:"__6j"},this.renderMessengerTitle(),this.renderMessengerDescription(),this.renderMessengerSource());return c('React').createElement('div',{className:"__6j"},this.renderTitle(),this.renderDescription(),this.renderSource(),this.props.extraComponent);};l.prototype.renderMessengerTitle=function(){if(!this.props.attachment.title)return null;return c('React').createElement('div',{className:"__6k"},c('React').createElement(c('LineClamp.react'),{customEllipsis:" ",lines:2,lineHeight:18},this.props.attachment.title));};l.prototype.renderMessengerDescription=function(){if(!this.props.attachment.description)return null;return c('React').createElement('div',{className:"__6l"},c('React').createElement(c('LineClamp.react'),{customEllipsis:" ",lines:2,lineHeight:16},this.props.attachment.description));};l.prototype.renderMessengerSource=function(){if(!this.props.attachment.source)return null;return c('React').createElement('div',{className:"__6m"},this.props.attachment.source);};l.prototype.renderTitle=function(){if(!this.props.attachment.title)return null;return c('React').createElement('div',{className:"__6k"+(!this.props.attachment.uri&&!this.props.attachment.description?' '+"_2xsq":'')+(!!this.props.extraComponent?' '+"_1dw9":'')},this.props.attachment.title);};l.prototype.renderDescription=function(){if(!this.props.attachment.description)return null;return c('React').createElement('div',{className:"__6l"},this.props.attachment.description);};l.prototype.renderSource=function(){if(!this.props.attachment.source)return null;return c('React').createElement('div',{className:"__6m"},this.props.attachment.source);};function l(){i.apply(this,arguments);}l.propTypes={attachment:c('MercuryShareAttachmentReactShape'),extraComponent:k.object,location:k.oneOf(c('MercuryShareAttachmentRenderLocations').getValues())};f.exports=l;}),null);
__d('MercuryFallbackShareAttachmentContent.react',['cx','Image.react','ImageBlock.react','MercuryFallbackShareAttachmentTextBlock.react','MercuryShareAttachmentRenderLocations','MercuryShareAttachmentReactShape','MercuryShareImage.react','MessengerAttachmentImageBlock.react','React','joinClasses'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes,l=72;i=babelHelpers.inherits(m,c('React').Component);j=i&&i.prototype;m.prototype.renderTextBlock=function(){return c('React').createElement(c('MercuryFallbackShareAttachmentTextBlock.react'),this.props);};m.prototype.renderChatImage=function(n){return c('React').createElement(c('ImageBlock.react'),{className:n,spacing:'medium'},c('React').createElement(c('MercuryShareImage.react'),{height:l,source:this.props.attachment.media.image,width:l}),c('React').createElement('div',{style:{display:'flex',justifyContent:'center',flexDirection:'column',height:l}},this.renderTextBlock()));};m.prototype.renderMessengerImage=function(n){return c('React').createElement(c('MessengerAttachmentImageBlock.react'),{className:n,attachment:this.props.attachment},this.renderTextBlock(),this.props.children);};m.prototype.renderDefaultImage=function(n){return c('React').createElement(c('ImageBlock.react'),{className:c('joinClasses')(this.props.className,n)},c('React').createElement(c('Image.react'),{className:"__6n",src:this.props.attachment.media.image,width:l}),this.renderTextBlock(),this.props.children);};m.prototype.getCSSClasses=function(){var n=this.props.attachment,o=this.props.location;return (c('MercuryShareAttachmentRenderLocations').CHAT===o?"_49or":'')+(c('MercuryShareAttachmentRenderLocations').CHAT_PREVIEW===o?' '+"_324d":'')+(c('MercuryShareAttachmentRenderLocations').CHAT!==o?' '+"_tih":'')+(!(n&&n.media.image)?' '+"_49ou":'')+(' '+"_310t");};m.prototype.render=function(){var n=this.props.attachment,o=this.props.location,p=this.getCSSClasses();if(n.media&&n.media.image){if(c('MercuryShareAttachmentRenderLocations').CHAT===o||c('MercuryShareAttachmentRenderLocations').CHAT_PREVIEW===o){return this.renderChatImage(p);}else if(c('MercuryShareAttachmentRenderLocations').MESSENGER===o)return this.renderMessengerImage(p);return this.renderDefaultImage(p);}return c('React').createElement('div',{className:c('joinClasses')(this.props.className,p)},this.renderTextBlock(),this.props.children);};function m(){i.apply(this,arguments);}m.propType={attachment:c('MercuryShareAttachmentReactShape'),location:k.oneOf(c('MercuryShareAttachmentRenderLocations').getValues())};f.exports=m;}),null);
__d('SaveMessageUtils',['immutable','StoryAttachmentStyle'],(function a(b,c,d,e,f,g){var h=c('immutable').Set.of(c('StoryAttachmentStyle').FALLBACK,c('StoryAttachmentStyle').SHARE,c('StoryAttachmentStyle').EVENT,c('StoryAttachmentStyle').ATTACHED_STORY,c('StoryAttachmentStyle').MUSIC_AGGREGATION,c('StoryAttachmentStyle').AVATAR),i={isSavableMessageAttachment:function j(k){for(var l=0;l<k.length;l++)if(!h.has(k[l]))return false;return true;}};f.exports=i;}),null);
__d("XMessengerDotComSavedForLaterNuxSeenController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/save\/savemessagenux\/",{});}),null);
__d('MercuryFallbackShareAttachment.react',['cx','fbt','AsyncRequest','CollectionsDisplaySurface','CollectionCurationMechanisms','Link.react','MercuryFallbackShareAttachmentContent.react','MercuryShareAttachmentRenderLocations','MercuryShareAttachmentReactShape','MessengerAdsWebTypedLogger','MessengerDotComSaveModule','MNAdsLoggerEventEnum','React','ReactFragment','SaveMessageUtils','XMessengerDotComSavedForLaterNuxSeenController','XUIAmbientNUX.react'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PropTypes,m='focus',n='click',o='scroll',p=10000,q=30000;j=babelHelpers.inherits(r,c('React').Component);k=j&&j.prototype;function r(){k.constructor.call(this);this.state={showNux:false,nuxDisabled:false};}r.prototype.renderLink=function(s){if(c('MercuryShareAttachmentRenderLocations').isPreview(this.props.location)||!this.props.attachment.uri)return s;return c('React').createElement(c('Link.react'),{className:"_5rw4",href:this.props.attachment.uri,onClick:this.$MercuryFallbackShareAttachment1.bind(this),target:'_blank'},s,this.renderLayers());};r.prototype.render=function(){return this.renderLink(c('React').createElement(c('MercuryFallbackShareAttachmentContent.react'),babelHelpers['extends']({ref:'mercury_fallback_share_attachment'},this.props)));};r.prototype.$MercuryFallbackShareAttachment1=function(event){if(this.props.isSponsored){var s=this.props.attachment&&this.props.attachment.subattachments;if(!s)return;for(var t=s,u=Array.isArray(t),v=0,t=u?t:t[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var w;if(u){if(v>=t.length)break;w=t[v++];}else{v=t.next();if(v.done)break;w=v.value;}var x=w;new (c('MessengerAdsWebTypedLogger'))().setEvent(c('MNAdsLoggerEventEnum').LINK_CLICK).setIsSponsored(this.props.isSponsored).setItemID(x&&x.id).setMessageID(this.props.messageID).setPageID(this.props.pageID).log();}}if(this.state.nuxDisabled||!this.$MercuryFallbackShareAttachment2())return;this.$MercuryFallbackShareAttachment3();this.interactionTime=0;this.cancelMinConsumeTimeout=setTimeout(function(){if(!this.$MercuryFallbackShareAttachment4())this.setState({showNux:true,nuxDisabled:true});}.bind(this),p);this.cancelMaxConsumeTimeout=setTimeout(function(){if(!this.$MercuryFallbackShareAttachment4()){this.setState({showNux:false,nuxDisabled:false});this.clearTimeouts();}}.bind(this),q);var y=Date.now();this.cancelWindowInteractionTimeout=setTimeout(function(){this.$MercuryFallbackShareAttachment5(function(){if(!this.interactionTime)this.interactionTime=Date.now()-y;}.bind(this));}.bind(this),0);};r.prototype.clearTimeouts=function(){if(this.cancelWindowInteractionTimeout){clearTimeout(this.cancelWindowInteractionTimeout);this.cancelWindowInteractionTimeout=null;}if(this.cancelMaxConsumeTimeout){clearTimeout(this.cancelMaxConsumeTimeout);this.cancelMaxConsumeTimeout=null;}if(this.cancelMinConsumeTimeout){clearTimeout(this.cancelMinConsumeTimeout);this.cancelMinConsumeTimeout=null;}};r.prototype.onNUXCloseButtonClick=function(){this.setState({showNux:false});this.$MercuryFallbackShareAttachment6();this.$MercuryFallbackShareAttachment7();this.clearTimeouts();};r.prototype.renderLayers=function(){return this.$MercuryFallbackShareAttachment2()?c('ReactFragment').create(c('React').createElement(c('XUIAmbientNUX.react'),{contextRef:function(){return this.refs.mercury_fallback_share_attachment;}.bind(this),shown:this.state.showNux,onCloseButtonClick:this.onNUXCloseButtonClick.bind(this),position:'below',width:'custom',customwidth:300},i._("\u53f3\u51fb\u6d88\u606f\u5373\u53ef\u628a\u94fe\u63a5\u548c\u89c6\u9891\u6536\u85cf\u5230 Facebook\u3002"))):null;};r.prototype.$MercuryFallbackShareAttachment3=function(){if(!this.$MercuryFallbackShareAttachment8){this.$MercuryFallbackShareAttachment9=[];this.$MercuryFallbackShareAttachment8=[Event.listen(window,'click',this.$MercuryFallbackShareAttachment10.bind(this,n)),Event.listen(window,'focus',this.$MercuryFallbackShareAttachment10.bind(this,m)),Event.listen(window,'scroll',this.$MercuryFallbackShareAttachment10.bind(this,o))];}};r.prototype.$MercuryFallbackShareAttachment10=function(s){this.$MercuryFallbackShareAttachment9.forEach(function(t){t.call(this,s);},this);};r.prototype.$MercuryFallbackShareAttachment5=function(s){this.$MercuryFallbackShareAttachment9.push(s);};r.prototype.$MercuryFallbackShareAttachment4=function(){return this.interactionTime&&this.interactionTime>0;};r.prototype.$MercuryFallbackShareAttachment7=function(){if(this.$MercuryFallbackShareAttachment8){while(this.$MercuryFallbackShareAttachment8.length)this.$MercuryFallbackShareAttachment8.pop().remove();this.$MercuryFallbackShareAttachment8=null;this.$MercuryFallbackShareAttachment9=null;}};r.prototype.$MercuryFallbackShareAttachment2=function(){return c('MessengerDotComSaveModule').eligible_for_nux&&this.$MercuryFallbackShareAttachment11();};r.prototype.$MercuryFallbackShareAttachment11=function(){var s=this.props.attachment;if(!s)return false;var t=s.style_list;return c('SaveMessageUtils').isSavableMessageAttachment(t);};r.prototype.$MercuryFallbackShareAttachment6=function(){new (c('AsyncRequest'))().setURI(c('XMessengerDotComSavedForLaterNuxSeenController').getURIBuilder().getURI()).setData({action:'impression',surface:c('CollectionsDisplaySurface').MESSENGER_DOT_COM_MESSAGE,mechanism:c('CollectionCurationMechanisms').SAVE_MESSAGE_NUX,object_id:this.props.message_id,collection_id:98}).send();};r.propTypes={attachment:c('MercuryShareAttachmentReactShape'),isSponsored:l.bool,location:l.oneOf(c('MercuryShareAttachmentRenderLocations').getValues()),messageID:l.string,pageID:l.string};f.exports=r;}),null);