if (self.CavalryLogger) { CavalryLogger.start_js(["CUU5T"]); }

__d("CampfireLoggerEvents",[],(function a(b,c,d,e,f,g){f.exports={CONSUME_READER_DRAFT:"consume_reader_draft",CONSUME_READER_PUBLISHED_NOTE:"consume_reader_published_note",CONSUME_READER_EXIT_DRAFT:"consume_reader_exit_draft",CONSUME_READER_EXIT_PUBLISHED:"consume_reader_exit_published",CONSUME_PERMALINK_DRAFT:"consume_permalink_draft",CONSUME_PERMALINK_PUBLISHED_NOTE:"consume_permalink_published_note",CONSUME_PERMALINK_EXIT_DRAFT:"consume_permalink_exit_draft",CONSUME_PERMALINK_EXIT_PUBLISHED:"consume_permalink_exit_published",CONSUME_AS_INSTANT_ARTICLE:"consume_as_instant_article",COMPOSE_CREATE_DRAFT:"compose_create_draft",COMPOSE_EDIT_DRAFT:"compose_edit_draft",COMPOSE_DELETE_DRAFT:"compose_delete_draft",COMPOSE_PUBLISH_DRAFT:"compose_publish_draft",COMPOSE_EDIT_PUBLISHED_NOTE:"compose_edit_published_note",COMPOSE_UPDATE_PUBLISHED_NOTE:"compose_update_published_note",COMPOSE_DELETE_PUBLISHED_NOTE:"compose_delete_published_note",COMPOSE_EXIT_COMPOSER:"compose_exit_composer"};}),null);
__d("CampfireLoggerNoteTypes",[],(function a(b,c,d,e,f,g){f.exports={CAMPFIRE:"campfire",MOBILE_CAMPFIRE:"mobile_campfire",OLD:"old"};}),null);
__d('CampfireTimeSpentMonitor',['BanzaiLogger','CampfireLoggerEvents','CampfireLoggerNoteTypes','Run'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){this.$CampfireTimeSpentMonitor1=i;this.$CampfireTimeSpentMonitor2=j;c('Run').onBeforeUnload(this.$CampfireTimeSpentMonitor4.bind(this));this.$CampfireTimeSpentMonitor3=Date.now();}h.prototype.$CampfireTimeSpentMonitor4=function(){var i=Date.now(),j=Math.round((i-this.$CampfireTimeSpentMonitor3)/1000);c('BanzaiLogger').log('CampfireNotesLoggerConfig',{event:c('CampfireLoggerEvents').CONSUME_PERMALINK_EXIT_PUBLISHED,event_time:i,note_id:Number(this.$CampfireTimeSpentMonitor1),note_type:c('CampfireLoggerNoteTypes').CAMPFIRE,author_id:Number(this.$CampfireTimeSpentMonitor2.ownerID),is_author_verified:this.$CampfireTimeSpentMonitor2.isAuthorVerified,is_author_page:this.$CampfireTimeSpentMonitor2.isAuthorPage,time_spent_reading_sec:j});};f.exports=h;}),null);
__d('SpotlightViewerAutoResize',['invariant','Event','SubscriptionsHandler'],(function a(b,c,d,e,f,g,h){function i(j){'use strict';this.$SpotlightViewerAutoResize1=j;typeof this.$SpotlightViewerAutoResize1.onResize==='function'||h(0);}i.prototype.enable=function(){'use strict';this.$SpotlightViewerAutoResize2=new (c('SubscriptionsHandler'))();this.$SpotlightViewerAutoResize2.addSubscriptions(c('Event').listen(window,'resize',this.$SpotlightViewerAutoResize1.onResize));};i.prototype.disable=function(){'use strict';this.$SpotlightViewerAutoResize2.release();delete this.$SpotlightViewerAutoResize2;};f.exports=i;}),null);
__d('SpotlightViewerBehaviorsMixin',['BehaviorsMixin'],(function a(b,c,d,e,f,g){var h={componentWillMount:function i(){this.behaviors&&this.enableBehaviors(this.behaviors);},componentWillUnmount:function i(){this.destroyBehaviors();}};Object.assign(h,c('BehaviorsMixin'));f.exports=h;}),null);
__d('SpotlightViewerClose',['cx','fbt','React','TooltipLink.react','joinClasses'],(function a(b,c,d,e,f,g,h,i){var j,k,l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;m.prototype.render=function(){'use strict';var n=this.props.position=='left'?"_5wx3":"_5wx4",o=c('React').createElement('span',null,i._("\u6309 Esc \u952e\u5173\u95ed"));return c('React').createElement(c('TooltipLink.react'),{className:c('joinClasses')("_4-o9 _50-m _51an",n),onClick:this.props.onClick,tooltip:o});};function m(){'use strict';j.apply(this,arguments);}m.propTypes={position:l.oneOf(['left','right'])};m.defaultProps={position:'right'};f.exports=m;}),null);
__d('PhotoViewState',['ArbiterMixin','PhotoStore','PhotoUtils','SpotlightViewerLoggingEvents','mixin'],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(k,l,m){'use strict';i.constructor.call(this);var n=m||{};this._viewer=k;this._setID=l;this._position=n.position||0;this._preventPreload=n.preventPreload;this._reverse=n.reverse;this._updateCallback=n.updateCallback;this._preloaded={};}j.prototype._fetchCallback=function(k){'use strict';if(!this._viewer.isOpen())return;this._preload(k);this._log(c('SpotlightViewerLoggingEvents').DATA_FETCH_COMPLETE);};j.prototype._preload=function(k){'use strict';c('PhotoUtils').preload(this._viewer,k,function(l){this._preloaded[c('PhotoUtils').getFBIDFromData(l)]=true;}.bind(this));};j.prototype._preloadPhotosInRange=function(k,l){'use strict';var m=[];for(var n=k;n<=l;++n){var o=c('PhotoStore').getByIndexImmediate(this._setID,n);if(o&&!this._isPreloaded(o))m.push(o);}this._preload(m);};j.prototype._isPreloaded=function(k){'use strict';return this._preloaded[c('PhotoUtils').getFBIDFromData(k)];};j.prototype.getPosition=function(){'use strict';return this._position;};j.prototype.isValidMovement=function(k){'use strict';if(!c('PhotoStore').hasBeenCreated(this._setID))return false;if(c('PhotoStore').hasLooped(this._setID))return true;var l=this._position+k,m=c('PhotoStore').getAvailableRange(this._setID),n=m.offset+m.length-1;return l>=m.offset-1&&l<=n+1;};j.prototype.getRelativeMovement=function(k){'use strict';return c('PhotoStore').getIndexForID(this._setID,k)-this._position;};j.prototype.moveCursor=function(k){'use strict';if(!this.isValidMovement(k))return false;this._position+=k;return true;};j.prototype._page=function(k){'use strict';if(!this.moveCursor(k))return;this._log(c('SpotlightViewerLoggingEvents').PAGE_BEGIN);var l=c('PhotoStore').getByIndexImmediate(this._setID,this._position);if(!l){this.inform('photo_fetch');this._log(c('SpotlightViewerLoggingEvents').PHOTO_FETCH);}else if(!this._isPreloaded(l))this._preload([l]);c('PhotoStore').getByIndex(this._setID,this._position,this._updateCallback);this._loadMoreIfNecessary(k>0,j.BUFFER_SIZE);this._log(c('SpotlightViewerLoggingEvents').PAGE_COMPLETE);};j.prototype.loadMoreForwardIfNecessary=function(k){'use strict';if(this._preventPreload)return;var l=c('PhotoStore').getAvailableRange(this._setID),m=l.offset+l.length-1,n=this._position+k;if(n>m&&!c('PhotoStore').hasLooped(this._setID)){var o=c('PhotoStore').getCursorByIndexImmediate(this._setID,m);c('PhotoStore').fetchForward(this._setID,o,k,this._fetchCallback.bind(this));}else this._preloadPhotosInRange(this._position+1,n);};j.prototype.loadMoreBackwardIfNecessary=function(k){'use strict';if(this._preventPreload)return;var l=c('PhotoStore').getAvailableRange(this._setID),m=this._position-k;if(m<l.offset&&!c('PhotoStore').hasLooped(this._setID)){var n=c('PhotoStore').getCursorByIndexImmediate(this._setID,l.offset);c('PhotoStore').fetchBackward(this._setID,n,k,this._fetchCallback.bind(this));}else this._preloadPhotosInRange(m,this._position-1);};j.prototype._loadMoreIfNecessary=function(k,l){'use strict';if(k){this.loadMoreForwardIfNecessary(l);}else this.loadMoreBackwardIfNecessary(l);};j.prototype.displayFirst=function(){'use strict';if(!this._viewer.isOpen())return;c('PhotoStore').setPreFetchCallback(this._setID,function(){this._log(c('SpotlightViewerLoggingEvents').DATA_FETCH_BEGIN);}.bind(this));var k=function(l){if(!this._isPreloaded(l))this._preload([l]);this._updateCallback&&this._updateCallback(l);}.bind(this);c('PhotoStore').getByIndex(this._setID,this._position,k);if(this._reverse){this.loadMoreBackwardIfNecessary(j.BUFFER_SIZE);}else this.loadMoreForwardIfNecessary(j.BUFFER_SIZE);};j.prototype.backward=function(){'use strict';this._page(this._reverse?1:-1);};j.prototype.forward=function(){'use strict';this._page(this._reverse?-1:1);};j.prototype._log=function(k){'use strict';this._viewer.log(k);};Object.assign(j,{BUFFER_SIZE:4});f.exports=j;}),null);
__d('SpotlightViewerCoreMixin',['PhotoLogger','PhotoStore','PhotoUtils','PhotoViewState','React','SpotlightViewerImage','SpotlightViewerLoggingEvents'],(function a(b,c,d,e,f,g){var h={_displayFirstPhoto:function i(){c('PhotoStore').executePostCreate(this.props.setid,this.viewState.displayFirst.bind(this.viewState));},_getInitialPosition:function i(){var j;if(!this.props.clearcache)j=c('PhotoStore').getIndexForID(this.props.setid,this.props.photoid);if(j===undefined){c('PhotoStore').clearSetCache(this.props.setid);j=0;}return j;},__displayPhoto:function i(){var j=this._getInitialPosition();this.viewState=new (c('PhotoViewState'))(this,this.props.setid,{position:j,preventPreload:this.__shouldPreventPhotoPreload,reverse:this.props.reverse,updateCallback:this._updatePhoto});this.inform('open');this._displayFirstPhoto();},componentWillMount:function i(){this._logger=new (c('PhotoLogger'))(this.getViewerID());this.log(c('SpotlightViewerLoggingEvents').OPEN_BEGIN);this.__displayPhoto();},componentDidMount:function i(){this._enableSubscriptions&&this._enableSubscriptions();this.log(c('SpotlightViewerLoggingEvents').OPEN_COMPLETE);},isOpen:function i(){return this.state.open;},close:function i(){if(!this.isOpen())return;this.log(c('SpotlightViewerLoggingEvents').CLOSE_BEGIN);this.setState({open:false},function(){this.inform('close');this.log(c('SpotlightViewerLoggingEvents').CLOSE_COMPLETE);});},componentWillUnmount:function i(){this.viewState=null;},_onClickViewport:function i(j){j?this.viewState.forward():this.viewState.backward();},_getMedia:function i(j,k){return c('React').createElement(c('SpotlightViewerImage'),{ref:'image',src:j.uri,dimensions:k.imageDimensions});},_getCurrentFBID:function i(){return c('PhotoUtils').getFBIDFromData(this.state.photoData);},_updatePhoto:function i(j){this.log(c('SpotlightViewerLoggingEvents').PHOTO_CHANGE_BEGIN);this.setState({photoData:j},function(){this.inform('photo_change',this.state.photoData);this.log(c('SpotlightViewerLoggingEvents').PHOTO_CHANGE_COMPLETE);});},getLogger:function i(){return this._logger;},log:function i(j){this._logger&&this._logger.logEvent(j);}};f.exports=h;}),null);
__d('PhotoViewerDimensions',['Event','PhotoUtils','Vector'],(function a(b,c,d,e,f,g){var h={verticalPadding:'number',horizontalPadding:'number',normalResDim:'object'};function i(j){'use strict';this._verticalPadding=40;this._horizontalPadding=60;this._normalResDim={x:960,y:960};this._photoStripHeight=88;for(var k in j){if(!h[k])throw new Error("Unsupported extraData value '"+k+"' should not be used");if(typeof j[k]===h[k])this['_'+k]=j[k];}this._listener=c('Event').listen(window,'resize',this._resetMaxStageDimensions.bind(this));}i.prototype.destroy=function(){'use strict';this._listener.remove();};i.prototype.getStageDimensions=function(j){'use strict';var k=this.getMaxStageDimensions(),l=new (c('Vector'))(Math.min(j.x,k.x),Math.min(j.y,k.y)),m=l.x/l.y,n=j.x/j.y;if(m<n){l.y=Math.round(l.x/n);}else l.x=Math.round(l.y*n);return l;};i.prototype.getImageDimensionsForStage=function(j,k){'use strict';var l=j.x,m=j.y,n=k.x,o=k.y;if(l>=n||m>=o){var p=l/m,q=n/o;if(q<p){l=n;m=Math.round(n/p);}else if(q>p){l=Math.round(o*p);m=o;}else{l=n;m=o;}}return new (c('Vector'))(l,m);};i.prototype.getImageDimensionsForMaxStage=function(j,k){'use strict';var l=j.x,m=j.y,n=k.x,o=k.y-this._photoStripHeight,p=l/m,q=n/o;if(l>=n||m>=o){if(q<p){l=n;m=Math.round(n/p);}else if(q>p){l=Math.round(o*p);m=o;}else{l=n;m=o;}}else if(p<q){l=Math.round(m*p);}else m=Math.round(l/p);return new (c('Vector'))(l,m);};i.prototype.getMaxStageDimensions=function(){'use strict';if(!this._maxStageDimensions)this._maxStageDimensions=new (c('Vector'))(c('Vector').getViewportDimensions().x-this._horizontalPadding,c('Vector').getViewportDimensions().y-this._verticalPadding);return this._maxStageDimensions;};i.prototype.getMaxStageDimensionsWithoutPadding=function(){'use strict';if(!this._maxStageDimensions)this._maxStageDimensions=new (c('Vector'))(c('Vector').getViewportDimensions().x,c('Vector').getViewportDimensions().y);return this._maxStageDimensions;};i.prototype._resetMaxStageDimensions=function(){'use strict';this._maxStageDimensions=null;};i.prototype.getBestFitImageFromPhoto=function(j,k){'use strict';var l=null,m=c('PhotoUtils').getImagesFromData(j);m=m.sort(function(o,p){return p.width-o.width;});if(window.devicePixelRatio&&window.devicePixelRatio>1)k=new (c('Vector'))(k.x*window.devicePixelRatio,k.y*window.devicePixelRatio);for(var n=0;n<m.length;n++)if(!l||m[n].width>=k.x||m[n].height>=k.y)l=m[n];return l;};i.prototype.getOriginalDimensionsFromPhoto=function(j){'use strict';var k=c('PhotoUtils').getOriginalImageFromData(j);return new (c('Vector'))(k.width,k.height);};i.prototype.getBestFitDimensionsFromPhoto=function(j,k){'use strict';var l=this.getBestFitImageFromPhoto(j,k);return new (c('Vector'))(l.width,l.height);};i.prototype.getVerticalPadding=function(){'use strict';return this._verticalPadding;};i.prototype.getHorizontalPadding=function(){'use strict';return this._horizontalPadding;};f.exports=i;}),null);
__d('SpotlightViewerStageResizer',['MessengerEnvironment','Event','SubscriptionsHandler','Vector'],(function a(b,c,d,e,f,g){var h=520;function i(j,k){'use strict';this._subscriptionsHandler=new (c('SubscriptionsHandler'))();this._subscriptionsHandler.addSubscriptions(c('Event').listen(window,'resize',this._resetStageDimensions.bind(this)));this._dimensions=j;this._minHeight=k.minHeight||h;this._minWidth=k.minWidth||h;this._resetStageDimensions();}i.prototype.destroy=function(){'use strict';this._dimensions=null;this._subscriptionsHandler.release();};i.prototype._resetStageDimensions=function(){'use strict';this._currentStageDimensions=new (c('Vector'))(this._minWidth,this._minHeight);};i.prototype.getImageAndStageDimensions=function(j){'use strict';var k=this._dimensions.getBestFitDimensionsFromPhoto(j,this._dimensions.getMaxStageDimensions()),l=c('MessengerEnvironment').messengerui?this._dimensions.getMaxStageDimensionsWithoutPadding(k):this._dimensions.getStageDimensions(k);this._currentStageDimensions=new (c('Vector'))(Math.max(l.x,this._minWidth,this._currentStageDimensions.x),Math.max(l.y,this._minHeight,this._currentStageDimensions.y));var m=c('MessengerEnvironment').messengerui?this._dimensions.getImageDimensionsForMaxStage(k,this._currentStageDimensions):this._dimensions.getImageDimensionsForStage(k,this._currentStageDimensions);return {stageDimensions:this._currentStageDimensions,imageDimensions:m};};i.prototype.getCurrentStageDimensions=function(){'use strict';return this._currentStageDimensions;};f.exports=i;}),null);
__d('SpotlightViewerDimensionMixin',['MessengerEnvironment','SpotlightViewerStageResizer','PhotoViewerDimensions'],(function a(b,c,d,e,f,g){var h={getInitialState:function i(){this._dimensions=new (c('PhotoViewerDimensions'))({verticalPadding:this.props.verticalPadding,horizontalPadding:this.props.horizontalPadding});this._resizer=new (c('SpotlightViewerStageResizer'))(this._dimensions,{minHeight:this.props.minHeight,minWidth:this.props.minWidth});return {maxStageDimensions:c('MessengerEnvironment').messengerui?this._dimensions.getMaxStageDimensionsWithoutPadding():this._dimensions.getMaxStageDimensions()};},componentWillUnmount:function i(){this._resizer&&this._resizer.destroy();this._resizer=null;this._dimensions&&this._dimensions.destroy();this._dimensions=null;},getMedia:function i(){if(this.state.photoData){if(this.state.photoData.__typename&&this.state.photoData.__typename==='MessageVideo')return this._getVideo();var j=this._resizer.getImageAndStageDimensions(this.state.photoData),k=this._dimensions.getBestFitImageFromPhoto(this.state.photoData,this.state.maxStageDimensions);return this._getMedia(k,j);}else return null;},getDimensions:function i(){return this._dimensions;},getStageDimensions:function i(){if(this.state.photoData){return this._resizer.getImageAndStageDimensions(this.state.photoData).stageDimensions;}else return c('MessengerEnvironment').messengerui?this._dimensions.getMaxStageDimensionsWithoutPadding():this._dimensions.getMaxStageDimensions();},getImageDimensions:function i(){if(!this.state.photoData)return null;return this._resizer.getImageAndStageDimensions(this.state.photoData).imageDimensions;},onResize:function i(){if(c('MessengerEnvironment').messengerui){var j=this._dimensions.getMaxStageDimensionsWithoutPadding();this.setState({maxStageDimensions:j,width:j.x});}else this.setState({maxStageDimensions:this._dimensions.getMaxStageDimensions()});}};f.exports=h;}),null);
__d('SpotlightViewerPageWithKeys',['KeyEventController','SubscriptionsHandler'],(function a(b,c,d,e,f,g){function h(i){'use strict';this.$SpotlightViewerPageWithKeys1=i;}h.prototype.enable=function(){'use strict';this.$SpotlightViewerPageWithKeys2=new (c('SubscriptionsHandler'))();this.$SpotlightViewerPageWithKeys2.addSubscriptions(c('KeyEventController').registerKey('LEFT',function(){this.$SpotlightViewerPageWithKeys1.viewState.backward();return false;}.bind(this)),c('KeyEventController').registerKey('RIGHT',function(){this.$SpotlightViewerPageWithKeys1.viewState.forward();return false;}.bind(this)));};h.prototype.disable=function(){'use strict';this.$SpotlightViewerPageWithKeys2.release();delete this.$SpotlightViewerPageWithKeys2;};f.exports=h;}),null);
__d('SpotlightViewerPagers',['cx','LeftRight.react','Link.react','React'],(function a(b,c,d,e,f,g,h){var i,j;i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){'use strict';return c('React').createElement(c('LeftRight.react'),null,c('React').createElement(c('Link.react'),{className:"_4-oa _4-ob _50-m"}),c('React').createElement(c('Link.react'),{className:"_4-oa _4-oc _50-m"}));};function k(){'use strict';i.apply(this,arguments);}f.exports=k;}),null);
__d('SpotlightViewerThumbnailMixin',['PhotoStore','Vector'],(function a(b,c,d,e,f,g){var h={_getInitialPhotoData:function i(){var j=c('PhotoStore').getIndexForID(this.props.setid,this.props.photoid),k=c('PhotoStore').getByIndexImmediate(this.props.setid,j);return k?k:this._getThumbnailPhotoData();},_getThumbnailPhotoData:function i(){if(!this.props.dimensions||!this.props.thumbsrc)return null;var j={id:this.props.photoid};for(var k=0;k<this.props.dimensions.length;++k){var l=c('Vector').deserialize(this.props.dimensions[k]);j['image'+k]={width:l.x,height:l.y,uri:this.props.thumbsrc};}return j;}};f.exports=h;}),null);
__d('SpotlightSnowflakePhotoViewer',['ArbiterMixin','React','SpotlightViewer','SpotlightViewerAutoResize','SpotlightViewerBehaviorsMixin','SpotlightViewerClose','SpotlightViewerCoreMixin','SpotlightViewerDimensionMixin','SpotlightViewerPagers','SpotlightViewerPageWithKeys','SpotlightViewerThumbnailMixin','SpotlightViewport','SubscriptionsHandler'],(function a(b,c,d,e,f,g){var h=c('React').createClass({displayName:'SpotlightSnowflakePhotoViewer',mixins:[c('ArbiterMixin'),c('SpotlightViewerBehaviorsMixin'),c('SpotlightViewerCoreMixin'),c('SpotlightViewerThumbnailMixin'),c('SpotlightViewerDimensionMixin')],behaviors:[c('SpotlightViewerPageWithKeys'),c('SpotlightViewerAutoResize')],getViewerID:function i(){return 'photoviewer';},componentWillUnmount:function i(){this._subscriptions&&this._subscriptions.release();this._subscriptions=null;},getInitialState:function i(){this._subscriptions=new (c('SubscriptionsHandler'))();return {photoData:this._getInitialPhotoData(),open:true};},_enableSubscriptions:function i(){this.props.useloadingindicator&&this._subscriptions.addSubscriptions(this.viewState.subscribe('photo_fetch',this.setState.bind(this,{photoData:null},null)));},render:function i(){var j=this.getMedia(),k=this.getStageDimensions(),l=this.props.useloadingindicator&&!this.state.photoData;return c('React').createElement(c('SpotlightViewer'),{open:this.state.open,onHide:this.close},c('React').createElement(c('SpotlightViewport'),{media:j,showLoadingIndicator:l,stageDimensions:k,onClick:this._onClickViewport},c('React').createElement(c('SpotlightViewerClose'),{onClick:this.close}),this.props.disablepaging?null:c('React').createElement(c('SpotlightViewerPagers'),null)));}});f.exports=h;}),null);
__d('CampfireImageViewer',['DOM','Event','React','ReactDOM','SpotlightSnowflakePhotoViewer','ge'],(function a(b,c,d,e,f,g){'use strict';var h={registerPopup:function i(j,k){c('Event').listen(j,'click',function(l){h.bootstrap({src:k.src,fbid:k.id,dimensions:[k.width,k.height].join(','),disablePaging:true});});},bootstrap:function i(j){var k=c('React').createElement(c('SpotlightSnowflakePhotoViewer'),{dimensions:[j.dimensions],open:true,disablepaging:true,photoid:j.fbid,reverse:false,rootClassName:j.rootClassName,thumbsrc:j.src});h.render(k);},render:function i(j){var k=c('ge')('campfire_viewer');if(!k){k=c('DOM').create('div',{id:'messages_viewer'});document.body.appendChild(k);}j=c('ReactDOM').render(j,k);j.subscribeOnce('close',function(){c('ReactDOM').unmountComponentAtNode(k);});}};f.exports=h;}),null);